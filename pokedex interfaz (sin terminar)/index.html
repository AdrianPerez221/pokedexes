<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokédex Interactiva Mejorada</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background-image: linear-gradient(to bottom, #87CEEB, #f5f5f5);
        }

        .pokedex-container {
            display: flex;
            max-width: 900px;
            gap: 10px;
        }

        .pokedex-main {
            background-color: #cc0000;
            border-radius: 20px;
            padding: 20px;
            width: 380px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .pokedex-inner {
            background-color: #aa0000;
            border-radius: 15px;
            padding: 15px;
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .top-lights {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .big-light {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #99ddff, #00aaff, #0088cc);
            border: 2px solid #0088cc;
            margin-right: 20px;
            position: relative;
            overflow: hidden;
        }

        .big-light::after {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            top: 5px;
            left: 5px;
        }

        .small-lights {
            display: flex;
            gap: 10px;
        }

        .small-light {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .red { background-color: #ff0000; }
        .yellow { background-color: #ffff00; }
        .green { background-color: #00ff00; }

        .main-screen {
            background-color: #dedede;
            border: 3px solid #444;
            border-radius: 10px;
            height: 250px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .pokemon-display {
            background-color: white;
            border-radius: 5px;
            width: 90%;
            height: 80%;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .pokemon-image {
            max-width: 100%;
            max-height: 100%;
            transition: all 0.3s;
        }

        .pokemon-name {
            background-color: #222;
            color: white;
            width: 60%;
            text-align: center;
            padding: 5px;
            margin-top: 5px;
            border-radius: 5px;
            font-size: 18px;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .d-pad {
            width: 80px;
            height: 80px;
            background-color: #222;
            border-radius: 50%;
            position: relative;
            align-self: flex-start;
            margin-left: 20px;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
        }

        .d-pad::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 30%;
            background-color: #333;
        }

        .d-pad::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30%;
            height: 70%;
            background-color: #333;
        }

        .left-arrow, .right-arrow {
            position: absolute;
            width: 0;
            height: 0;
            z-index: 10;
            cursor: pointer;
        }

        .left-arrow {
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 15px solid #777;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .right-arrow {
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-left: 15px solid #777;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .left-arrow:hover, .right-arrow:hover {
            opacity: 0.8;
        }

        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-self: flex-end;
            margin-right: 20px;
        }

        .top-buttons {
            display: flex;
            gap: 15px;
        }

        .button {
            background-color: #222;
            border-radius: 5px;
            color: white;
            padding: 5px 15px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }

        .button:hover {
            background-color: #333;
            transform: translateY(-2px);
        }

        .button:active {
            background-color: #444;
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .search-container {
            display: flex;
            flex-direction: column;
            margin-top: 20px;
            gap: 10px;
            width: 100%;
        }

        .search-row {
            display: flex;
            gap: 10px;
        }

        .id-input, .name-input {
            padding: 8px;
            border: 2px solid #333;
            border-radius: 5px;
            text-align: center;
            background-color: #f0f0f0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
        }

        .id-input:focus, .name-input:focus {
            outline: none;
            border-color: #0088cc;
            box-shadow: 0 0 5px rgba(0, 136, 204, 0.5);
        }

        .id-input {
            width: 60px;
        }

        .name-input {
            flex-grow: 1;
        }

        .search-button {
            background-color: #222;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }

        .search-button:hover {
            background-color: #333;
            transform: translateY(-2px);
        }

        .search-button:active {
            background-color: #444;
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .suggestions {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 150px;
            overflow-y: auto;
            width: 100%;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .suggestion-item:hover {
            background-color: #f5f5f5;
        }

        /* Parte derecha - Pantalla de estadísticas */
        .pokedex-stats {
            background-color: #cc0000;
            border-radius: 20px;
            padding: 20px;
            width: 340px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .stats-inner {
            background-color: #aa0000;
            border-radius: 15px;
            padding: 15px;
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .stats-screen {
            background-color: #dedede;
            border: 3px solid #444;
            border-radius: 10px;
            height: 400px;
            margin-bottom: 20px;
            padding: 10px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .stats-content {
            background-color: white;
            border-radius: 5px;
            padding: 15px;
            height: 93%;
            overflow-y: auto;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .stats-tabs {
            display: flex;
            justify-content: space-between;
        }

        .stats-tab {
            background-color: #222;
            color: white;
            padding: 8px 0;
            text-align: center;
            width: 32%;
            border-radius: 5px;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }

        .stats-tab.active {
            background-color: #0088cc;
            transform: translateY(-2px);
        }

        .stats-tab:hover {
            background-color: #333;
        }

        .stats-tab:active {
            background-color: #444;
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .pokemon-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .types {
            display: flex;
            gap: 10px;
        }

        .type {
            padding: 3px 10px;
            border-radius: 15px;
            color: white;
            font-size: 0.9em;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .normal { background-color: #A8A77A; }
        .fire { background-color: #EE8130; }
        .water { background-color: #6390F0; }
        .electric { background-color: #F7D02C; }
        .grass { background-color: #7AC74C; }
        .ice { background-color: #96D9D6; }
        .fighting { background-color: #C22E28; }
        .poison { background-color: #A33EA1; }
        .ground { background-color: #E2BF65; }
        .flying { background-color: #A98FF3; }
        .psychic { background-color: #F95587; }
        .bug { background-color: #A6B91A; }
        .rock { background-color: #B6A136; }
        .ghost { background-color: #735797; }
        .dragon { background-color: #6F35FC; }
        .dark { background-color: #705746; }
        .steel { background-color: #B7B7CE; }
        .fairy { background-color: #D685AD; }

        .moves-table {
            width: 100%;
            border-collapse: collapse;
        }

        .moves-table th, .moves-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .moves-table th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .moves-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .moves-table tr:hover {
            background-color: #f1f1f1;
        }

        .connector {
            width: 50px;
            height: 180px;
            background-color: #cc0000;
            align-self: center;
            position: relative;
            margin-top: 180px;
        }

        .connector::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            width: 100%;
            height: 70%;
            background-color: #aa0000;
        }

        .loading {
            font-size: 18px;
            text-align: center;
            margin-top: 40%;
        }

        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .filter-badge {
            background-color: #f0f0f0;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-badge:hover {
            background-color: #e0e0e0;
        }

        .filter-badge.active {
            color: white;
        }

        .filter-badge.active.normal { background-color: #A8A77A; }
        .filter-badge.active.fire { background-color: #EE8130; }
        .filter-badge.active.water { background-color: #6390F0; }
        .filter-badge.active.electric { background-color: #F7D02C; }
        .filter-badge.active.grass { background-color: #7AC74C; }
        .filter-badge.active.ice { background-color: #96D9D6; }
        .filter-badge.active.fighting { background-color: #C22E28; }
        .filter-badge.active.poison { background-color: #A33EA1; }
        .filter-badge.active.ground { background-color: #E2BF65; }
        .filter-badge.active.flying { background-color: #A98FF3; }
        .filter-badge.active.psychic { background-color: #F95587; }
        .filter-badge.active.bug { background-color: #A6B91A; }
        .filter-badge.active.rock { background-color: #B6A136; }
        .filter-badge.active.ghost { background-color: #735797; }
        .filter-badge.active.dragon { background-color: #6F35FC; }
        .filter-badge.active.dark { background-color: #705746; }
        .filter-badge.active.steel { background-color: #B7B7CE; }
        .filter-badge.active.fairy { background-color: #D685AD; }

        .option-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .toggle-shiny, .filter-button {
            background-color: #333;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .toggle-shiny:hover, .filter-button:hover {
            transform: translateY(-2px);
            background-color: #444;
        }

        .toggle-shiny:active, .filter-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .toggle-shiny.active {
            background-color: #f7d02c;
            color: #333;
        }

        .filter-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .filter-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            max-width: 90%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .close-filter {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }

        .type-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .apply-filters, .reset-filters {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .apply-filters {
            background-color: #0088cc;
            color: white;
        }

        .reset-filters {
            background-color: #f0f0f0;
            color: #333;
        }

        .apply-filters:hover {
            background-color: #0077b3;
        }

        .reset-filters:hover {
            background-color: #e0e0e0;
        }

        @media (max-width: 900px) {
            .pokedex-container {
                flex-direction: column;
                align-items: center;
            }
            .connector {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="pokedex-container">
        <!-- Parte izquierda - Pokédex principal -->
        <div class="pokedex-main">
            <div class="pokedex-inner">
                <div class="top-lights">
                    <div class="big-light"></div>
                    <div class="small-lights">
                        <div class="small-light red"></div>
                        <div class="small-light yellow"></div>
                        <div class="small-light green"></div>
                    </div>
                </div>
                
                <div class="main-screen">
                    <div class="pokemon-display">
                        <img src="" alt="Pokemon" class="pokemon-image" id="pokemon-image">
                    </div>
                    <div class="pokemon-name" id="pokemon-name">Cargando...</div>
                </div>
                
                <div class="controls">
                    <div class="d-pad">
                        <div class="left-arrow" id="prev-pokemon"></div>
                        <div class="right-arrow" id="next-pokemon"></div>
                    </div>
                    
                    <div class="buttons-container">
                        <div class="top-buttons">
                            <div class="button" id="info-button">INFO</div>
                            <div class="button" id="stats-button">STATS</div>
                        </div>
                        
                        <div class="option-buttons">
                            <button class="toggle-shiny" id="toggle-shiny">
                                <span>✨ Shiny</span>
                            </button>
                            <button class="filter-button" id="open-filter">
                                <span>🔍 Filtrar</span>
                            </button>
                        </div>
                        
                        <div class="search-container">
                            <div class="search-row">
                                <input type="number" class="id-input" id="pokemon-id-input" placeholder="#" min="1">
                                <button class="search-button" id="search-id-button">Buscar</button>
                            </div>
                            <div class="search-row" style="position: relative;">
                                <input type="text" class="name-input" id="pokemon-name-input" placeholder="Nombre del Pokémon">
                                <button class="search-button" id="search-name-button">Buscar</button>
                                <div class="suggestions" id="suggestions"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Parte derecha - Pantalla de estadísticas -->
        <div class="pokedex-stats">
            <div class="stats-inner">
                <div class="stats-screen">
                    <div class="stats-content" id="stats-content">
                        <div class="loading">Selecciona un Pokémon...</div>
                        <!-- Contenido de las pestañas -->
                        <div class="tab-content" id="info-tab">
                            <div class="pokemon-info">
                                <!-- Se llenará dinámicamente -->
                            </div>
                        </div>
                        
                        <div class="tab-content" id="moves-tab">
                            <table class="moves-table">
                                <thead>
                                    <tr>
                                        <th>Nivel</th>
                                        <th>Movimiento</th>
                                        <th>Tipo</th>
                                    </tr>
                                </thead>
                                <tbody id="moves-table-body">
                                    <!-- Se llenará dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="tab-content" id="stats-tab">
                            <canvas id="stats-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="stats-tabs">
                    <div class="stats-tab active" data-tab="info-tab">INFO</div>
                    <div class="stats-tab" data-tab="moves-tab">MOVS</div>
                    <div class="stats-tab" data-tab="stats-tab">STATS</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Diálogo de filtro por tipo -->
    <div class="filter-dialog" id="filter-dialog">
        <div class="filter-content">
            <div class="filter-header">
                <h3>Filtrar por tipo</h3>
                <button class="close-filter" id="close-filter">&times;</button>
            </div>
            <div class="type-filters" id="type-filters">
                <!-- Se llenará dinámicamente -->
            </div>
            <div class="filter-actions">
                <button class="reset-filters" id="reset-filters">Restablecer</button>
                <button class="apply-filters" id="apply-filters">Aplicar</button>
            </div>
        </div>
    </div>

    <script>
       // Variables globales
let currentPokemonId = 1;
let totalPokemon = 151; // Limitado a la primera generación
let statsChart = null;
let isShiny = false;
let allPokemonList = [];
let filteredPokemonIds = [];
let activeTypeFilters = [];
let pokemonTypes = [
    'normal', 'fire', 'water', 'electric', 'grass', 'ice', 
    'fighting', 'poison', 'ground', 'flying', 'psychic', 
    'bug', 'rock', 'ghost', 'dragon', 'dark', 'steel', 'fairy'
];

// Elementos DOM
const pokemonImage = document.getElementById('pokemon-image');
const pokemonName = document.getElementById('pokemon-name');
const prevButton = document.getElementById('prev-pokemon');
const nextButton = document.getElementById('next-pokemon');
const searchIdButton = document.getElementById('search-id-button');
const searchNameButton = document.getElementById('search-name-button');
const idInput = document.getElementById('pokemon-id-input');
const nameInput = document.getElementById('pokemon-name-input');
const infoButton = document.getElementById('info-button');
const statsButton = document.getElementById('stats-button');
const statsTabs = document.querySelectorAll('.stats-tab');
const tabContents = document.querySelectorAll('.tab-content');
const infoTab = document.getElementById('info-tab');
const movesTab = document.getElementById('moves-tab');
const statsTab = document.getElementById('stats-tab');
const movesTableBody = document.getElementById('moves-table-body');
const statsContent = document.getElementById('stats-content');
const suggestions = document.getElementById('suggestions');
const toggleShinyButton = document.getElementById('toggle-shiny');
const openFilterButton = document.getElementById('open-filter');
const filterDialog = document.getElementById('filter-dialog');
const closeFilterButton = document.getElementById('close-filter');
const typeFilters = document.getElementById('type-filters');
const applyFiltersButton = document.getElementById('apply-filters');
const resetFiltersButton = document.getElementById('reset-filters');

// Inicializar la aplicación
window.addEventListener('DOMContentLoaded', async () => {
    // Obtener la lista de todos los Pokémon para la funcionalidad de búsqueda
    try {
        const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=151');
        const data = await response.json();
        allPokemonList = data.results.map((pokemon, index) => {
            return {
                id: index + 1,
                name: pokemon.name,
                url: pokemon.url
            };
        });
        
        // Inicializar los filtros de tipo
        initializeTypeFilters();
        
        // Cargar el primer Pokémon
        fetchPokemon(currentPokemonId);
        
        // Configurar event listeners
        setupEventListeners();
    } catch (error) {
        console.error('Error al inicializar la Pokédex:', error);
    }
});

// Configurar event listeners
function setupEventListeners() {
    prevButton.addEventListener('click', () => {
        if (filteredPokemonIds.length > 0) {
            // Si hay filtros activos, navegar por la lista filtrada
            const currentIndex = filteredPokemonIds.indexOf(currentPokemonId);
            if (currentIndex > 0) {
                currentPokemonId = filteredPokemonIds[currentIndex - 1];
                fetchPokemon(currentPokemonId);
            }
        } else {
            // Sin filtros, navegación normal
            if (currentPokemonId > 1) {
                currentPokemonId--;
                fetchPokemon(currentPokemonId);
            }
        }
    });

    nextButton.addEventListener('click', () => {
        if (filteredPokemonIds.length > 0) {
            // Si hay filtros activos, navegar por la lista filtrada
            const currentIndex = filteredPokemonIds.indexOf(currentPokemonId);
            if (currentIndex < filteredPokemonIds.length - 1) {
                currentPokemonId = filteredPokemonIds[currentIndex + 1];
                fetchPokemon(currentPokemonId);
            }
        } else {
            // Sin filtros, navegación normal
            if (currentPokemonId < totalPokemon) {
                currentPokemonId++;
                fetchPokemon(currentPokemonId);
            }
        }
    });

    searchIdButton.addEventListener('click', () => {
        const id = parseInt(idInput.value);
        if (id && id > 0 && id <= totalPokemon) {
            currentPokemonId = id;
            fetchPokemon(currentPokemonId);
            idInput.value = '';
        } else {
            alert('Por favor, introduce un ID válido (1-151)');
        }
    });

    searchNameButton.addEventListener('click', () => {
        const searchName = nameInput.value.toLowerCase().trim();
        if (searchName) {
            const foundPokemon = allPokemonList.find(p => p.name.toLowerCase() === searchName);
            if (foundPokemon) {
                currentPokemonId = foundPokemon.id;
                fetchPokemon(currentPokemonId);
                nameInput.value = '';
                suggestions.style.display = 'none';
            } else {
                alert('Pokémon no encontrado, verifica el nombre');
            }
        }
    });

    // Búsqueda con sugerencias
    nameInput.addEventListener('input', () => {
        const searchText = nameInput.value.toLowerCase().trim();
        if (searchText.length > 1) {
            const matchingPokemon = allPokemonList.filter(p => 
                p.name.toLowerCase().includes(searchText)
            ).slice(0, 5); // Limitamos a 5 sugerencias
            
            if (matchingPokemon.length > 0) {
                suggestions.innerHTML = '';
                matchingPokemon.forEach(pokemon => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.textContent = `${pokemon.id}. ${pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1)}`;
                    item.addEventListener('click', () => {
                        currentPokemonId = pokemon.id;
                        fetchPokemon(currentPokemonId);
                        nameInput.value = '';
                        suggestions.style.display = 'none';
                    });
                    suggestions.appendChild(item);
                });
                suggestions.style.display = 'block';
            } else {
                suggestions.style.display = 'none';
            }
        } else {
            suggestions.style.display = 'none';
        }
    });

    // Ocultar sugerencias al hacer clic fuera
    document.addEventListener('click', (e) => {
        if (e.target !== nameInput && e.target !== suggestions) {
            suggestions.style.display = 'none';
        }
    });

    // Cambiar pestañas
    statsTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            statsTabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(t => t.classList.remove('active'));
            
            tab.classList.add('active');
            const tabId = tab.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });

    // Botones de información
    infoButton.addEventListener('click', () => {
        document.querySelector(`.stats-tab[data-tab="info-tab"]`).click();
    });

    statsButton.addEventListener('click', () => {
        document.querySelector(`.stats-tab[data-tab="stats-tab"]`).click();
    });

    // Toggler de Shiny
    toggleShinyButton.addEventListener('click', () => {
        isShiny = !isShiny;
        toggleShinyButton.classList.toggle('active');
        updatePokemonImage(currentPokemonId);
    });

    // Manejo de filtro de tipo
    openFilterButton.addEventListener('click', () => {
        filterDialog.style.display = 'flex';
    });

    closeFilterButton.addEventListener('click', () => {
        filterDialog.style.display = 'none';
    });

    applyFiltersButton.addEventListener('click', async () => {
        if (activeTypeFilters.length === 0) {
            // Si no hay filtros activos, usamos la lista completa
            filteredPokemonIds = [];
        } else {
            // Buscar pokémon que coinciden con los filtros
            filteredPokemonIds = await filterPokemonByTypes(activeTypeFilters);
            if (filteredPokemonIds.length > 0) {
                // Ir al primer pokémon de la lista filtrada
                currentPokemonId = filteredPokemonIds[0];
                fetchPokemon(currentPokemonId);
            } else {
                alert('No se encontraron Pokémon con los tipos seleccionados');
                resetFilters();
            }
        }
        filterDialog.style.display = 'none';
    });

    resetFiltersButton.addEventListener('click', () => {
        resetFilters();
    });
}

// Función para inicializar los filtros de tipo
function initializeTypeFilters() {
    typeFilters.innerHTML = '';
    pokemonTypes.forEach(type => {
        const filterBadge = document.createElement('div');
        filterBadge.className = `filter-badge ${type}`;
        filterBadge.textContent = type.charAt(0).toUpperCase() + type.slice(1);
        filterBadge.dataset.type = type;
        
        filterBadge.addEventListener('click', () => {
            filterBadge.classList.toggle('active');
            
            if (filterBadge.classList.contains('active')) {
                if (!activeTypeFilters.includes(type)) {
                    activeTypeFilters.push(type);
                }
            } else {
                activeTypeFilters = activeTypeFilters.filter(t => t !== type);
            }
        });
        
        typeFilters.appendChild(filterBadge);
    });
}

// Función para filtrar Pokémon por tipos
async function filterPokemonByTypes(types) {
    if (types.length === 0) return [];
    
    try {
        const filteredIds = [];
        
        // Primero filtramos por el primer tipo seleccionado
        const primaryType = types[0];
        const response = await fetch(`https://pokeapi.co/api/v2/type/${primaryType}`);
        const data = await response.json();
        
        // Obtenemos los pokémon que tienen el tipo primario
        const pokemonWithType = data.pokemon
            .map(p => {
                // Extraer el ID del URL
                const urlParts = p.pokemon.url.split('/');
                return parseInt(urlParts[urlParts.length - 2]);
            })
            .filter(id => id <= totalPokemon); // Limitamos a Gen 1
        
        if (types.length === 1) {
            // Si solo hay un tipo, devolvemos esta lista
            return pokemonWithType;
        } else {
            // Si hay más tipos, hay que verificar cada Pokémon
            for (const pokemonId of pokemonWithType) {
                const pokemonResponse = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonId}`);
                const pokemonData = await pokemonResponse.json();
                
                // Obtenemos los tipos del pokémon
                const pokemonTypes = pokemonData.types.map(t => t.type.name);
                
                // Verificamos si tiene todos los tipos seleccionados
                const hasAllTypes = types.every(type => pokemonTypes.includes(type));
                
                if (hasAllTypes) {
                    filteredIds.push(pokemonId);
                }
            }
            
            return filteredIds;
        }
    } catch (error) {
        console.error('Error al filtrar por tipos:', error);
        return [];
    }
}

// Función para resetear filtros
function resetFilters() {
    activeTypeFilters = [];
    filteredPokemonIds = [];
    
    // Quitar clase activa de todos los filtros
    document.querySelectorAll('.filter-badge').forEach(badge => {
        badge.classList.remove('active');
    });
}

// Función para obtener datos del Pokémon
async function fetchPokemon(id) {
    try {
        // Mostrar mensaje de carga
        pokemonName.textContent = 'Cargando...';
        pokemonImage.src = '';
        statsContent.innerHTML = '<div class="loading">Cargando datos...</div>';
        
        // Fetch Pokémon data
        const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
        const pokemon = await response.json();
        
        // Actualizar ID actual
        currentPokemonId = pokemon.id;
        
        // Actualizar imagen y nombre
        updatePokemonImage(pokemon.id);
        pokemonName.textContent = pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1);
        
        // Cargar datos en pestañas
        loadInfoTab(pokemon);
        loadMovesTab(pokemon);
        loadStatsTab(pokemon);
        
        // Mostrar la pestaña que estaba activa
        const activeTab = document.querySelector('.stats-tab.active').getAttribute('data-tab');
        document.getElementById(activeTab).classList.add('active');
        
    } catch (error) {
        console.error('Error al cargar el Pokémon:', error);
        pokemonName.textContent = 'Error';
        statsContent.innerHTML = '<div class="loading">Error al cargar datos</div>';
    }
}

// Actualizar imagen del Pokémon (normal o shiny)
function updatePokemonImage(id) {
    const imageType = isShiny ? 'front_shiny' : 'front_default';
    pokemonImage.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${isShiny ? 'shiny/' : ''}${id}.png`;
    pokemonImage.alt = `Pokémon #${id}`;
    
    // Animación al cambiar
    pokemonImage.style.transform = 'scale(0.8)';
    setTimeout(() => {
        pokemonImage.style.transform = 'scale(1)';
    }, 100);
}

// Cargar pestaña de información
function loadInfoTab(pokemon) {
    const infoContent = document.querySelector('#info-tab .pokemon-info');
    
    // Fetch especie para obtener datos adicionales
    fetch(pokemon.species.url)
        .then(res => res.json())
        .then(species => {
            // Encontrar la descripción en español
            const description = species.flavor_text_entries.find(
                entry => entry.language.name === 'es'
            )?.flavor_text || 'Descripción no disponible';
            
            // Preparar contenido de información
            infoContent.innerHTML = `
                <div class="info-row">
                    <strong>Número:</strong>
                    <span>#${pokemon.id.toString().padStart(3, '0')}</span>
                </div>
                <div class="info-row">
                    <strong>Altura:</strong>
                    <span>${(pokemon.height / 10).toFixed(1)} m</span>
                </div>
                <div class="info-row">
                    <strong>Peso:</strong>
                    <span>${(pokemon.weight / 10).toFixed(1)} kg</span>
                </div>
                <div class="info-row">
                    <strong>Tipos:</strong>
                    <div class="types">
                        ${pokemon.types.map(t => 
                            `<span class="type ${t.type.name}">${t.type.name.charAt(0).toUpperCase() + t.type.name.slice(1)}</span>`
                        ).join('')}
                    </div>
                </div>
                <div class="info-row">
                    <strong>Habilidades:</strong>
                    <span>${pokemon.abilities.map(a => 
                        a.ability.name.charAt(0).toUpperCase() + a.ability.name.slice(1)
                    ).join(', ')}</span>
                </div>
                <div class="info-row" style="flex-direction: column;">
                    <strong>Descripción:</strong>
                    <p style="margin-top: 5px;">${description.replace(/\f/g, ' ')}</p>
                </div>
            `;
        })
        .catch(error => {
            console.error('Error al cargar info de especie:', error);
            infoContent.innerHTML = '<p>Error al cargar información detallada</p>';
        });
}

// Cargar pestaña de movimientos
function loadMovesTab(pokemon) {
    // Limpiar tabla existente
    movesTableBody.innerHTML = '';
    
    // Obtener movimientos por nivel
    const levelUpMoves = pokemon.moves
        .filter(move => move.version_group_details.some(
            detail => detail.move_learn_method.name === 'level-up'
        ))
        .sort((a, b) => {
            const levelA = a.version_group_details.find(
                d => d.move_learn_method.name === 'level-up'
            ).level_learned_at;
            const levelB = b.version_group_details.find(
                d => d.move_learn_method.name === 'level-up'
            ).level_learned_at;
            return levelA - levelB;
        });
    
    // Agregar cada movimiento a la tabla
    levelUpMoves.forEach(move => {
        const level = move.version_group_details.find(
            d => d.move_learn_method.name === 'level-up'
        ).level_learned_at;
        
        const row = document.createElement('tr');
        
        // Cargar información del tipo del movimiento
        fetch(move.move.url)
            .then(res => res.json())
            .then(moveData => {
                row.innerHTML = `
                    <td>${level}</td>
                    <td>${move.move.name.replace('-', ' ')}</td>
                    <td><span class="type ${moveData.type.name}">${moveData.type.name}</span></td>
                `;
                movesTableBody.appendChild(row);
            })
            .catch(error => {
                console.error('Error al cargar datos del movimiento:', error);
                row.innerHTML = `
                    <td>${level}</td>
                    <td>${move.move.name.replace('-', ' ')}</td>
                    <td>Error</td>
                `;
                movesTableBody.appendChild(row);
            });
    });
    
    // Si no hay movimientos por nivel
    if (levelUpMoves.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="3">No se encontraron movimientos por nivel</td>';
        movesTableBody.appendChild(row);
    }
}

// Cargar pestaña de estadísticas
function loadStatsTab(pokemon) {
    const statsCanvas = document.getElementById('stats-chart');
    
    // Preparar datos para el gráfico
    const statNames = ['HP', 'Ataque', 'Defensa', 'At. Esp.', 'Def. Esp.', 'Velocidad'];
    const statValues = pokemon.stats.map(stat => stat.base_stat);
    
    // Destruir gráfico anterior si existe
    if (statsChart) {
        statsChart.destroy();
    }
    
    // Crear nuevo gráfico
    statsChart = new Chart(statsCanvas, {
        type: 'radar',
        data: {
            labels: statNames,
            datasets: [{
                label: 'Estadísticas base',
                data: statValues,
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgb(54, 162, 235)',
                pointBackgroundColor: 'rgb(54, 162, 235)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgb(54, 162, 235)'
            }]
        },
        options: {
            elements: {
                line: {
                    borderWidth: 3
                }
            },
            scales: {
                r: {
                    angleLines: {
                        display: true
                    },
                    suggestedMin: 0,
                    suggestedMax: 150
                }
            }
        }
    });
}